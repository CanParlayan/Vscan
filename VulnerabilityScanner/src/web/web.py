import urllib.request
from urllib.error import HTTPError, URLError
import socket

from VulnerabilityScanner.src.web import useragents

reply = False


def gethtml(url, lasturl=False):
    global reply
    if not (url.startswith("http://") or url.startswith("https://")):
        url = "http://" + url

    header = useragents.get()
    request = urllib.request.Request(url, None, header)
    html = None

    try:
        reply = urllib.request.urlopen(request, timeout=10)

    except HTTPError as e:
        if e.code == 500:
            html = e.read()

    except URLError as e:
        print(f"URLError: {e.reason}")

    except socket.timeout:
        print("Timeout Error: Request timed out")

    except KeyboardInterrupt:
        raise KeyboardInterrupt

    except Exception as e:
        print(f"An unexpected error occurred: {e}")

    else:
        html = reply.read()

    if html:
        if lasturl:
            return html, reply.url
        else:
            return html

    return False
