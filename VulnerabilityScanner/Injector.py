import requests
from bs4 import BeautifulSoup as BeautifulSoup


from abc import abstractmethod


class Injections:

    def __init__(self, quiet):
        self.quiet = quiet

    @staticmethod
    def get_all_forms_html(url):

        req = requests.get(url).content

        soup = BeautifulSoup(req, 'html.parser')

        return soup.find_all('form')

    @staticmethod
    def get_form_details(form):

        details_form = {"inputs": [], "action": form.attrs.get('action', '').lower(),
                        "method": form.attrs.get('method', 'get').lower()}

        for tag in form.find_all(["input", "textarea", "select"]):
            input_type = tag.attrs.get("type", "text")
            input_name = tag.attrs.get("name")
            input_value = tag.attrs.get("value", "") if input_type != "select" else ""

            if input_type == "textarea":
                input_value = tag.get_text()

            if input_type == "select":
                options = tag.find_all("option")
                selected_value = next(
                    (option.attrs.get("value", "") for option in options if 'selected' in option.attrs), "")
                if not selected_value and options:
                    selected_value = options[0].attrs.get("value", "")
                input_value = selected_value

            details_form["inputs"].append({"type": input_type, "name": input_name, "value": input_value})

        return details_form

    @abstractmethod
    def scan_host(self, *args, **kwargs):
        pass
